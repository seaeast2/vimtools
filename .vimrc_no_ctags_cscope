" python 언어 서버 설정
" pip install 'python-lsp-server[all]'
"========= default variables setting ==========
set cindent
set smartindent
set autoindent
set ff=unix
set bg=dark
set ruler
set number
set modifiable
set hlsearch
set ts=4
set sw=4
set sts=4
set mouse=c
set expandtab
set encoding=utf-8
set fileencodings=utf-8,euc-kr

syntax enable
set incsearch
set ignorecase
set printoptions=portrait:n,wrap:n,duplex:off

"========= vundle setting =========
set nocompatible               " be iMproved
filetype off                   " required!

set rtp+=~/.vim/bundle/Vundle.vim/
call vundle#begin()

" let Vundle manage Vundle required! 
Plugin 'VundleVim/Vundle.vim'

" Plugins
Plugin 'tpope/vim-fugitive'
Plugin 'scrooloose/nerdtree'
Plugin 'tpope/vim-surround'
Plugin 'dense-analysis/ale'
Plugin 'scrooloose/nerdcommenter'
Plugin 'github/copilot.vim'
Plugin 'ctrlpvim/ctrlp.vim'

" 제거: command-t, sparkup, autotag, tagbar (ctags 의존)
" Plugin 'wincent/command-t.git'
" Plugin 'rstacruz/sparkup', {'rtp': 'vim/'}
" Plugin 'craigemery/vim-autotag'
" Plugin 'majutsushi/tagbar'

call vundle#end()
filetype plugin indent on     " required!

"============== Nerd Tree Settings ========
let NERDTreeWinPos = 'left'

"============== ALE LSP Navigation Settings ========
" 언어 서버 연결 예시
let g:ale_linters = {
\   'python': ['pylsp'],
\   'c': ['clangd'],
\   'cpp': ['clangd'],
\   'javascript': ['tsserver'],
\   'typescript': ['tsserver'],
\}

" 탐색 매핑
nmap gd :ALEGoToDefinition<CR>
nmap gr :ALEFindReferences<CR>
nmap gi :ALEGoToImplementation<CR>
nmap K :ALEHover<CR>

"============== key mapping ===============
map <F2> v]}zf
map <F3> zo
map <F5> :NERDTreeToggle<CR> 
map <F9> :CtrlPBuffer<CR>

map <PageUp> <C-U><C-U>
map <PageDown> <C-D><C-D>

nmap <silent> <C-H> <C-W>h 
nmap <silent> <C-J> <C-W>j 
nmap <silent> <C-K> <C-W>k 
nmap <silent> <C-L> <C-W>l 

"========= switch between file buffers ========
map ,x :bn!<CR>
map ,z :bp!<CR>
map ,w :bw<CR>
map ,1 :b!1<CR>
map ,2 :b!2<CR>
map ,3 :b!3<CR>
map ,4 :b!4<CR>
map ,5 :b!5<CR>
map ,6 :b!6<CR>
map ,7 :b!7<CR>
map ,8 :b!8<CR>
map ,9 :b!9<CR>
map ,0 :b!0<CR>

"============ man page setting =============
func! Man()
    let sm = expand("<cword>")
    exe "!man -S 2:3:4:5:6:7:8:9:tcl:n:l:p:o ".sm
endfunc
nmap ,ma :call Man()<cr><cr>

"============ make setting =============
let startdir = getcwd()
func! Make()
    exe "!cd ".startdir
    exe "make"
endfunc
nmap ,mk :call Make()<cr><cr>

"============ hexViewer setting =============
let b:hexViewer = 0
func! Hv()
    if (b:hexViewer == 0)
        let b:hexViewer = 1
        exe "%!xxd"
    else
        let b:hexViewer = 0
        exe "%!xxd -r"
    endif
endfunc
nmap ,h :call Hv()<cr>

"============ file buffer CleanClose =============
func! CleanClose(tosave)
    if (a:tosave == 1)
        w!
    endif
    let todelbufNr = bufnr("%")
    let newbufNr = bufnr("#")
    if ((newbufNr != -1) && (newbufNr != todelbufNr) && buflisted(newbufNr))
        exe "b".newbufNr
    else
        bnext
    endif
    if (bufnr("%") == todelbufNr)
        new
    endif
    exe "bd".todelbufNr
endfunc
nmap ,cf :call CleanClose(0)<cr>

"============ open CWD =============
nmap ,od :e ./<cr>

"============ project specific settings =============
if filereadable(".project.vimrc")
    source .project.vimrc
endif

"============ NERD Commenter settings =============
let g:NERDSpaceDelims = 1
let g:NERDCompactSexyComs = 1
let g:NERDDefaultAlign = 'left'
let g:NERDAltDelims_java = 1
let g:NERDCustomDelimiters = { 'c': { 'left': '/**','right': '*/' } }
let g:NERDCommentEmptyLines = 1
let g:NERDTrimTrailingWhitespace = 1
map <Leader>cc <plug>NERDComToggleComment
map <Leader>c<space> <plug>NERDComComment

